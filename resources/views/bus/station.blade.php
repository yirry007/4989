@extends('bus.layout')@section('content')	<div class="tab">		<a href="<?php echo e(url('bus/line')) ?>">公交线路查询</a>		<a href="javascript:void(0);" class="v">公交站点查询</a>	</div>	<div class="find">		<div>			<input type="text" name="station" value="" placeholder="输入公交站" oninput="getStation(this);" />			<a href="javascript:void(0);" onclick="search_station(this, false);">搜索</a>			<ul class="search_station_list"></ul>		</div>	</div>	<div class="history">		<div class="history_wrap">			<h3>历史记录（只显示前10条）</h3>			<div id="station_history"></div>			<a href="javascript:void(0);" class="clear" onclick="clearHistory();">清空记录</a>		</div>	</div>@endsection@section('script')	<script>		$(function(){			$('.search_station_list').on('click', 'li', function(){				$('input[name=station]').val($(this).html());				localStorage.setItem('station_name', $(this).html());				$('.search_station_list').hide();				$('input[name=station]').focus();			});			$(document).keyup(function(event){				if(event.keyCode == 13){					search_station();				}			});			var station_history = localStorage.getItem('station_history');			if(!station_history){				station_history = [];			}else{				station_history = JSON.parse(station_history);			}			var html = '';			$(station_history).each(function(k, v){				html += '<a href="javascript:void(0);" onclick="search_station(this, true);">'+v+'</a>';			});			$('#station_history').html(html);		});		function getStation (obj) {			var keyword = $(obj).val();			if(keyword === ''){				$('.search_station_list').hide();			}else{				$('.search_station_list').show();				AMap.plugin(["AMap.StationSearch"], function() {					var station = new AMap.StationSearch({						pageIndex: 1,						pageSize: 50,						city: adcode					});					keyword += '公交站'					station.search(keyword, function(status, result) {						if(status === 'complete'){							var html = '';							$(result.stationInfo).each(function(k, v){								if(v.adcode !== adcode){									return true;								}								html += '<li>'+v.name+'</li>';							});							$('.search_station_list').html(html);						}					});				});			}		}		function search_station (obj, is_history) {			if(is_history){				localStorage.setItem('station_name', $(obj).html());			}			var station_name = localStorage.getItem('station_name');			var station = $('input[name=station]').val();			if((!station_name || station === '') && !is_history){				alert('请选择公交站名称');				return false;			}			if(!is_history){				var station_history = localStorage.getItem('station_history');				if(!station_history){					station_history = [];				}else{					station_history = JSON.parse(station_history);				}				if($.inArray(station_name, station_history) === -1){					station_history.unshift(station_name);					if(station_history.length > 10){						station_history.pop();					}					localStorage.setItem('station_history', JSON.stringify(station_history));				}			}			window.location.href = '<?php echo e(url('bus/station_list')); ?>';		}		function clearHistory () {			if(confirm('确定要删除历史记录吗？')){				localStorage.removeItem('station_history');				$('#station_history').html('');			}		}	</script>@endsection