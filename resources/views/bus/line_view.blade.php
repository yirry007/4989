@extends('bus.layout')@section('content')	<div class="line_view_head">		<div class="lines">			<div></div>		</div>		<div class="line_info"></div>	</div>	<div class="line_view">		<ul>			<li class="first">				<em class="dot"></em>				<h2></h2>			</li>			<li>				<em></em>				<h2 class="on_station"></h2>				<div class="replace_lines"></div>				<div class="via_list">					<p class="sep"></p>				</div>			</li>			<li>				<em></em>				<h2 class="off_station"></h2>				<p class="last_walk"></p>			</li>			<li class="last">				<em class="dot"></em>				<h2></h2>			</li>		</ul>	</div>@endsection@section('script')	<script>		$(function(){			var org = localStorage.getItem('org');			var des = localStorage.getItem('des');			var org_name = localStorage.getItem('org_name');			var des_name = localStorage.getItem('des_name');			$('input[name=org_name]').val(org_name);			$('input[name=des_name]').val(des_name);			$('li.first h2').html(org_name);			$('li.last h2').html(des_name);			AMap.plugin('AMap.Transfer', function() {				var transfer = new AMap.Transfer({					city: city,					policy: AMap.Transfer.NO_SUBWAY,					nightflag: false,					cityd: city,					extensions: 'all',				})				var startLngLat = org.split(',');				var endLngLat = des.split(',');				transfer.search(startLngLat, endLngLat, function (status, result) {					if(status == 'complete'){						var plans = result.plans;						var index = localStorage.getItem('search_index');						var plan = plans[index];						//console.log(plan);						var dis = (plan.distance / 1000).toFixed(1);						var stations = 0;						var bus_index = 0;						var lines_html = '';						var replace_lines = '';						var replace_station = '';						var station_list = '';						var off_station = '';						$(plan.segments).each(function(k, v){							if(v.transit_mode === 'BUS'){								stations += v.transit.via_stops.length;								if(bus_index !== 0){									lines_html += '<span>&gt;</span>';									station_list += '<h2>换乘'+v.transit.lines[0].name+'</h2>';								}else{									$('.on_station').html(v.transit.on_station.name);									station_list += '<p>' + v.transit.on_station.name + ' 上车<span><img src="<?php echo e(url('public/bus/img/bus.png')) ?>" /></span></p>';								}								if(bus_index === 1){									replace_station = v.transit.on_station.name+'换乘'+v.transit.lines[0].name;								}								lines_html += '<p>';								$(v.transit.lines).each(function(k1, v1){									var bus_name = v1.name.split('路');									var via_v = '';									if(k1 !== 0){										lines_html += '/';									}else{										//via_v = 'class="v"';									}									lines_html += bus_name[0] + '路';									if(bus_index === 0){										replace_lines += '<a href="javascript:void(0);" '+via_v+'>'+bus_name[0]+'路</a>';									}								});								lines_html += '</p>';								$(v.transit.via_stops).each(function(k1, v1){									station_list += '<p>'+v1.name+'</p>';									if(k1 === v.transit.via_stops.length-1){										station_list += '<p>'+v.transit.off_station.name+'</p>';									}								});								bus_index++;								off_station = v.transit.off_station.name;							}						});						var line_info = stations + '站 总距离：' + dis + 'km';						$('.lines div').html(lines_html);						$('.line_info').html(line_info);						$('.replace_lines').html(replace_lines);						$('.sep').html(replace_station);						$('.via_list').append(station_list);						$('.off_station').html(off_station);						var last_seg = plan.segments[plan.segments.length-1];						$('.last_walk').html(last_seg.instruction + '（'+Math.ceil(last_seg.time/60)+'分钟）');					}				})			});		});	</script>@endsection