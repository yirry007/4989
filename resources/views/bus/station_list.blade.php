@extends('bus.layout')@section('content')	<div class="station_list_head">		<h2></h2>		<p>延边朝鲜族自治州 - 延吉</p>	</div>	<div class="station_list">		<h2>途径公交路线</h2>		<ul id="station_list"></ul>	</div>@endsection@section('script')	<script>		$(function(){			var station_name = localStorage.getItem('station_name');			$('.station_list_head h2').html(station_name);			AMap.plugin(["AMap.StationSearch"], function() {				var station = new AMap.StationSearch({					pageIndex: 1,					pageSize: 50,					city: adcode				});				station.search(station_name, function(status, result) {					if(status === 'complete'){						var _bus_line = result.stationInfo[0].buslines;						var bus_line = {};						$(_bus_line).each(function(k, v){							var line_name = (v.name.split('路'))[0] + '路';							if(bus_line.hasOwnProperty(line_name)){								bus_line[line_name].push(v);							}else{								bus_line[line_name] = [];								bus_line[line_name].push(v);							}						});						getLineList(bus_line);					}				});			});		});		function getLineList (lines) {			$.each(lines, function(k, v){				if(k.indexOf('停运') !== -1){					return true;				}				var line_id = 'line_' + parseInt(k)				var outerHtml = '<li><h3>'+k+'</h3><div id="'+line_id+'" bus_ids=""></div></li>';				$('#station_list').append(outerHtml);				(function(line_id){					$(v).each(function(k1, v1){						var bus_ids = $('#'+line_id).attr('bus_ids');						if(bus_ids === ''){							$('#'+line_id).attr('bus_ids', v1.id);						}else{							$('#'+line_id).attr('bus_ids', bus_ids + ',' + v1.id);						}						(function(bus_id){							AMap.plugin(["AMap.LineSearch"], function() {								var linesearch = new AMap.LineSearch({									pageIndex: 1,									pageSize: 1,									city: adcode,									extensions: "all"								});								linesearch.searchById(bus_id, function(status, result) {									if(status === 'complete'){										var line_info = result.lineInfo[0];										var html = '\										<a href="javascript:void(0);" bus_id="'+line_info.id+'" onclick="station_view(this);">\											<p>'+line_info.start_stop+' - '+line_info.end_stop+'</p>\											<p>首 '+timeTransform(line_info.stime)+' 末 '+timeTransform(line_info.etime)+'</p>\											<p>距离：'+parseFloat(line_info.distance).toFixed(2)+'km</p>\											<em></em>\										</a>';										var line_id = 'line_' + (line_info.name.split('路'))[0];										$('#'+line_id).append(html);									}								});							});						})(v1.id);					});				})(line_id);			});		}		function station_view (obj) {			var bus_id = $(obj).attr('bus_id');			var bus_ids = $(obj).parent('div').attr('bus_ids');			window.location.href = '<?php echo e(url('bus/station_view')) ?>?bus_id='+bus_id+'&bus_ids='+bus_ids;		}		function timeTransform (time) {			return typeof time === 'string' ? time.substring(0, 2) + ':' + time.substring(2) : '不详';		}	</script>@endsection